<header title='{{title}}' isBack='{{isBack}}'></header>

<view wx:if='{{boolShare}}' class='backindex' bindtap='backindex'>
  <text>回到首页</text>
</view>

<swiper class='ware'>
  <swiper-item wx:for='{{data.images}}'>
    <image src='{{item}}'></image>
  </swiper-item>
</swiper>


<view class='wareInfo'>
  <view class='sellInfo'>
    <view class='price'>
      <text class='prefer'><text class='num txtcolor '>¥{{data.groupPrice}}</text> 起</text>
      <text>¥{{data.basicPrice}}</text>
    </view>
    <view class='sellnum'>
      <text>已售{{data.sumSalesVolume||0}}份</text>
    </view>
  </view>
  <view class='detail'>
    <view class='txt'>
      <text class='text-2-eclips'>{{data.goodsName}}：{{data.goodsDescribe}}</text>
    </view>
    <view class='bd'></view>
    <view class='share'>
      <image src='/images/fenxiang@3x.svg'></image>
      <text>分享</text>
      <button open-type='share' class='share-btn' data-type='1'></button>
    </view>
  </view>
</view>

<block wx:if='{{!boolShare}}'>
  <view class='list list-content'>
    <view class='title'>
      <view class=''>
        <text>附近有<text class='txtcolor'>{{man}}</text>人在拼单，可直接参与</text>
      </view>
      <view class='more' bindtap='enterPage' data-url='../moreAssemble/moreAssemble' data-type='1'>
        <text class='mr5'>查看更多</text>
        <text>></text>
      </view>
    </view>
    <block wx:if='{{list.length}}'>

      <view class='list-item' wx:for='{{list}}' wx:key='{{index}}' wx:if='{{index<5}}'>
        <image src='{{item.headPortrait}}'></image>
        <view class=' user'>
          <text class='my' wx:if='{{item.isMe != 1}}'>我</text>
          <text class='name text-1-eclips'>{{item.wechatName}}</text>
        </view>
        <view class='info'>
          <text class='num'>已拼<text class='txtcolor'>{{item.groupAlready}}份</text></text>
          <text class='time'>剩余{{timeout[index].str}}分</text>
        </view>
        <view class='btn' wx:if='{{item.isMe == 0 }}' bindtap='sharepopup' data-index='{{index}}'>
          <text>分享拼单</text>
        </view>
        <view class='btn fail' wx:elif='{{!timeout[index].success}}'>
          <text class='price'><text class='mark'>¥</text>
          <text class='num'>{{item.orderPrice}}</text></text>
          <text class='tip'>拼单失败</text>
        </view>
        <view class='btn' wx:else bindtap='joinAssemble' data-index='{{index}}'>
          <text class='price'><text class='mark'>¥</text>
          <text class='num'>{{item.orderPrice}}</text></text>
          <text class='tip'>去拼单</text>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class='nodata'>
        <image src='/images/kym.svg'></image>
        <text>～~我要第一个拼团~～</text>
      </view>
    </block>
  </view>
  <view class='launch' bindtap='goAssemble'>
    <text><text class='txt-mark'></text>发起团购</text>
  </view>
</block>
<block wx:else>
  <block wx:if='{{init}}'>
    <view class='share-window list-content'>
      <image src='{{listdata.headPortrait}}'></image>
      <text class='name'>{{listdata.wechatName}}</text>
      <text class='tip'>已拼 <text class='txtcolor'>{{listdata.groupAlready}}份</text></text>
      <text class='time'>剩余{{timeout[0].str}}分</text>
      <view class='pr'>
        <button wx:if='{{!userInfo}}' open-type="getUserInfo" bindgetphonenumber="getUserInfo" class='hid-btn'></button>
        <button wx:elif='{{!userInfo.phone}}' open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class='hid-btn'></button>
        <view class='btn pr' bindtap='joinAssemble'>
          <text>¥{{listdata.orderPrice}}去拼单</text>
        </view>
      </view>
      <view class='pr'>
        <button wx:if='{{!userInfo}}' open-type="getUserInfo" bindgetphonenumber="getUserInfo" class='hid-btn'></button>
        <button wx:elif='{{!userInfo.phone}}' open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber" class='hid-btn'></button>
        <view class='btn-go' bindtap='goAssemble'>
          <text>发起拼团</text>
          <text class='icon-xyb icon'></text>
        </view>
      </view>
    </view>
  </block>
  <block wx:else>
    <view class='cover-window'></view>
  </block>
</block>

<!-- 分享弹窗 -->
<share-popup isShare='{{isShare}}' isShow='{{isShow}}' catchhide='hideShare' catchsharePyq='sharePyq'></share-popup>
<painter style='position: fixed;right: 1000px;bottom: -1000px' palette="{{template}}" bind:imgOK="getShareImg" />


<!-- 发起团购弹窗 -->
<popup isShow='{{isShow}}' isPopup='{{isGoAssemble}}' catchhide='hidePopup'>
  <view class='cover'>
    <view class='part1'>
      <view>
        <text class='title'>{{isJoin?'参与拼团':'发起拼团'}}</text>
        <text class='time' wx:if='{{isJoin}}'>剩余{{cur_timeout}}分</text>
      </view>
      <text class='icon-spxq_xzgb icon' bindtap='hidePopup'></text>
    </view>
    <view class='part2'>
      <view class='line' wx:if='{{filterFs.length<3}}'>
        <view class='circle cur start'>
          <view class='box'>
            <image src='/images/xiaosj1@2x.png' mode='aspectFit' class='triangle'></image>
            <text>{{filterFs[0].fs}}</text>
            <text class='bd'></text>
            <text class='small'>每份￥{{filterFs[0].jg}}</text>
          </view>
        </view>
        <view class='circle end'>
          <view class='box'>
            <image src='/images/xiaosj2.png' mode='aspectFit' class='triangle'></image>
            <text>{{filterFs[filterFs.length-1].fs}}</text>
            <text class='bd'></text>
            <text class='small'>每份￥{{filterFs[filterFs.length-1].jg}}</text>
          </view>
        </view>
      </view>
      <view class='line2' wx:else>
        <view class='item start'></view>
        <view class='item small'></view>
        <view class='item small'></view>
        <view class='item small'></view>
        <view class='item end'></view>
        <view class='circle cur start'>
          <view class='box'>
            <image src='/images/xiaosj1@2x.png' mode='aspectFit' class='triangle'></image>
            <text>{{filterFs[0].fs}}</text>
            <text class='bd'></text>
            <text class='small'>每份￥{{filterFs[0].jg}}</text>
          </view>
        </view>
        <view class='circle middle'>
          <view class='box'>
            <image src='/images/xiaosj2.png' mode='aspectFit' class='triangle'></image>
            <text>{{filterFs[1].fs}}</text>
            <text class='bd'></text>
            <text class='small'>每份￥{{filterFs[1].jg}}</text>
          </view>
        </view>
        <view class='circle end'>
          <view class='box'>
            <image src='/images/xiaosj2.png' mode='aspectFit' class='triangle'></image>
            <text>{{filterFs[filterFs.length-1].fs}}</text>
            <text class='bd'></text>
            <text class='small'>每份￥{{filterFs[filterFs.length-1].jg}}</text>
          </view>
        </view>
      </view>
    </view>
    <view class='part3'>
        <text class='name'>购买数量</text>
        <view class='btn'>
          <image src='/images/dp_js.svg' class='sub' bindtap='addReduce' data-type='0'  data-target='1'></image>
          <text class='number'>{{buyNum}}</text>
          <view class='add' bindtap='addReduce' data-type='1' data-target='1'>
            <text class='icon-num-add icon'></text>
          </view>
        </view>
    </view>
    <view class='part4'>
      <text>拼团规则：</text>
      <text>·拼单最少2份起。</text>
      <text>·若拼团成功，则价格以最终拼团价格为准，多付款项原路退回账户。</text>
      <text>·若拼团失败，则价格按1份商品的售价为准。</text>
    </view>
    <view class='part5'>
      <view class='money'><text>合计</text><text class='mark txtcolor'>￥</text><text class='num txtcolor'>{{totalPrice}}</text></view>
      <view class='go' bindtap='enterPage' data-url='../mating/mating' data-type='2'><text>下一步</text></view>
    </view>
  </view>
</popup>
<!-- <popup isShow='{{isShow}}' isPopup='{{isGoAssemble}}' catchhide='hidePopup'>
  <view class='cover'>
    <view class='part1'>
      <image class='coverImg' mode='aspectFit' src='{{data.goodsImg}}'></image>
      <view class='content'>
        <view class='price'>
          <text class='mark'>￥</text>{{totalPrice}}</view>
        <view class='prompt'>
          <text>已选：</text>
          <text>{{inventory[cur_in]}}</text>
        </view>
      </view>
      <text class='icon-spxq_xzgb' bindtap='hidePopup'></text>
    </view>
    <view class='bd'></view>
    <view class='part2'>
      <text class='title'>发起拼团</text>
      <view class='a-category xpk-1px-b'>
        <view class='item {{cur_in == index?"select":""}} {{isDis?"disable":""}}' wx:for='{{invent}}' bindtap='inClick' data-index='{{index}}' wx:key='{{index}}'>
          <text>{{item.fs}}份/{{item.jg}}元</text>
        </view>
      </view>
    </view>
    <view class='part3'>
      <text class='pro-text'>购买数量</text>
      <view class='btn'>
        <text class='icon-num-red icon' bindtap='addReduce' data-type='0'></text>
        <text class='number'>{{buyNum}}</text>
        <text class='icon-num-add icon' bindtap='addReduce' data-type='1'></text>
      </view>
    </view>
    <view class='limit {{buyNum>=maxnum?"":"hidden"}}'>
      <text>最多只能买{{maxnum}}份</text>
    </view>
    <view class='tips' wx:if='{{cur_wait}}'>
      <text>还差<text class='txtcolor'>{{cur_wait}}份</text>拼成，剩余{{cur_timeout}}</text>
    </view>
    <view class='tips' wx:else></view>
    <button class="part4" bindtap='enterPage' data-url='../mating/mating' data-type='2'>下一步</button>
  </view>
</popup> -->